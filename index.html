<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <!-- iOS safe area -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
    />

    <title>ArmPal</title>

    <!-- âœ… ONESIGNAL SDK (REQUIRED) -->
    <script
      src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js"
      defer
    ></script>

    <!-- ðŸ”¥ ARMPAL SPLASH (INLINE â€” CANNOT FAIL) -->
    <style>
      #ap-splash {
        position: fixed;
        inset: 0;
        background: #000;
        z-index: 2147483647;
        display: grid;
        place-items: center;
      }

      #ap-splash img {
        width: min(46vw, 220px);
        opacity: 0;
        transform: scale(0.9);
        filter: blur(10px);
        animation: ap-in 900ms cubic-bezier(.2,.9,.25,1) forwards;
      }

      @keyframes ap-in {
        to {
          opacity: 1;
          transform: scale(1);
          filter: blur(0);
        }
      }

      #ap-splash.ap-out {
        animation: ap-out 260ms ease-out forwards;
      }

      @keyframes ap-out {
        to { opacity: 0; }
      }
    </style>

    <script>
      (function () {
        const splash = document.createElement("div");
        splash.id = "ap-splash";
        splash.innerHTML =
          '<img src="/pwa-512x512.png" alt="ArmPal" />';
        document.documentElement.appendChild(splash);

        // ðŸ”Š Metal clank sound
        try {
          const ctx = new (window.AudioContext || window.webkitAudioContext)();
          const play = async () => {
            if (ctx.state === "suspended") await ctx.resume();
            const o = ctx.createOscillator();
            const g = ctx.createGain();
            o.type = "triangle";
            o.frequency.value = 420;
            g.gain.setValueAtTime(0.001, ctx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.35, ctx.currentTime + 0.01);
            g.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.28);
            o.connect(g).connect(ctx.destination);
            o.start();
            o.stop(ctx.currentTime + 0.3);
          };
          play();
        } catch {}

        const start = performance.now();
        const MIN_MS = 1200;

        const remove = () => {
          const elapsed = performance.now() - start;
          const wait = Math.max(0, MIN_MS - elapsed);
          setTimeout(() => {
            splash.classList.add("ap-out");
            setTimeout(() => splash.remove(), 280);
          }, wait);
        };

        const root = document.getElementById("root");
        if (root) {
          const obs = new MutationObserver(() => {
            obs.disconnect();
            remove();
          });
          obs.observe(root, { childList: true });
        }

        setTimeout(remove, 3000);
      })();
    </script>
  </head>

  <body style="margin: 0; padding: 0; background: #000;">
    <div id="root"></div>

    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
